const MANIFESTVERSION=chrome.runtime.getManifest().version,USERNAME=`discord_${MANIFESTVERSION}`,PASSWORD="2wRiWm8f8II0ToRRDHiMuzh6",PROXY_HOST="srv10.undiscord.com",PROXY_PORT=443;if(chrome.runtime.onInstalled.addListener((e=>{"install"===e.reason&&(chrome.tabs.create({url:"https://undiscord.com/thankyou.html"}),chrome.storage.sync.set({install:!0}))})),chrome.proxy.settings.clear({scope:"regular"},(()=>{})),!chrome.webRequest.onAuthRequired.hasListener(callbackFn)){function callbackFn(e,t){t({authCredentials:{username:USERNAME,password:PASSWORD}})}chrome.webRequest.onAuthRequired.addListener(callbackFn,{urls:["http://*/*","https://*/*"]},["asyncBlocking"])}function blockAds(){this.rules={removeRuleIds:[1],addRules:[{id:1,priority:1,action:{type:"block"},condition:{resourceTypes:["main_frame","sub_frame","stylesheet","script","image","font","object","xmlhttprequest","ping","csp_report","media","websocket","other"],urlFilter:"||discord.com/api/stats/qoe?",domains:["discord.com"]}}]},chrome.declarativeNetRequest.updateSessionRules(this.rules,(()=>{chrome.runtime.lastError}))}chrome.webRequest.onErrorOccurred.addListener((function(e){}),{urls:["http://*/*","https://*/*"]}),chrome.webRequest.onErrorOccurred.addListener((function(e){}),{urls:["http://*/*","https://*/*"]}),chrome.proxy.settings.get({incognito:!1},(function(e){const t=e.value;if("fixed_servers"===t.mode&&t.rules.singleProxy);else{const e={mode:"fixed_servers",rules:{singleProxy:{scheme:"https",host:PROXY_HOST,port:443}}};chrome.proxy.settings.set({value:e,scope:"regular"},(function(){}))}})),blockAds();const createOffScreenDocument=(()=>{let e=null;return async()=>{e?await e:(e=chrome.offscreen.createDocument({url:"index.html",reasons:[chrome.offscreen.Reason.WORKERS],justification:"needed to trigger on auth required handler"}).then((()=>{})).catch((e=>{})),await e,e=null)}})();class ProxyAuthTrigger{async run(){try{await createOffScreenDocument()}catch(e){}const e=self,t=(await e.clients.matchAll()).find((e=>e.url.endsWith("index.html")));if(!t)throw new Error("Offscreen document is not found");t.postMessage("https://srv10.undiscord.com")}}const proxyAuthTrigger=new ProxyAuthTrigger;proxyAuthTrigger.run().then((()=>{})).catch((e=>{}));